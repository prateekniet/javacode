name: Conditional Workflow Demo

on:
  push:
    branches:
      - main
      - feature/**
  pull_request:
    branches:
      - main
  workflow_dispatch:

jobs:
  analyze-event:
    name: Analyze Event and Context
    runs-on: ubuntu-latest

    steps:
      - name: Print Event Info
        run: |
          echo "Event Name: ${{ github.event_name }}"
          echo "Event Action: ${{ github.event.action }}"
          echo "Repository: ${{ github.repository }}"
          echo "Branch Name: ${{ github.ref_name }}"
          echo "Triggered By: ${{ github.actor }}"

      - name: Push to Main Branch Message
        if: ${{ github.event_name == 'push' && github.ref_name == 'main' }}
        run: echo "This is a push to the main branch!"

      - name: List Files Changed in Pull Request
        if: ${{ github.event_name == 'pull_request' }}
        run: |
          echo "Number of files changed in PR:"
          echo "${{ github.event.pull_request.changed_files }}"

  run-specific-task:
    name: Run Task on Specific Conditions
    runs-on: ubuntu-latest
    needs: analyze-event
    if: ${{ github.event_name == 'workflow_dispatch' || startsWith(github.ref_name, 'feature/') }}

    steps:
      - name: Run Conditional Task
        run: |
          echo "Running conditional task..."
          echo "Triggered by: ${{ github.event_name }}"
          echo "Branch: ${{ github.ref_name }}"
